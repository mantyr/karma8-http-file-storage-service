# Karma8-http-file-storage-service

[![Software License](https://img.shields.io/badge/license-MIT-brightgreen.svg)](LICENSE.md)

Решение тестового задания.

## Задача

Вы разрабатываете сервис хранения файлов.

На сервер по HTTP PUT присылают файл, его надо разрезать на 5 равных частей и сохранить на 5 серверах хранения. При запросе HTTP GET нужно достать куски, склеить и отдать файл.

### Имеем следующее

- Один сервер для HTTP-запросов
- Несколько серверов (>5) для хранения кусков файлов

### Ограничения
- Реализовать тестовый модуль для сервиса, который обеспечит
проверку его функционала
- Сервера для хранения могут добавляться в систему в любой момент, но не могут удаляться из системы
- Предусмотреть равномерное заполнение серверов хранения
- Можно задавать вопросы и уточнять условия задачи
- Код разместить в Github
- Код может быть несовершенным — нам важно понять образ вашего мышления и подходов к решению задачи

## Проработка решения

### Архитектурный скетч

![karma8-http-file-storate-service-v1.drawio.svg](docs/karma8-http-file-storate-service-v1.drawio.svg "Общая схема взаимодействия сервисов и компонентов")

### Сервисы

#### karma8 gw

- Принимает запросы от пользователя
- Проверяет доступ на чтение файла во время запроса клиента (опционально)
- Проверяет доступ на запись файла во время запроса клиента (опционально)

> **Note**
> 
> Сервис не содержит реализации проверки прав доступа через IAM (Identity and Access Management), но для примера содержит пример доступности namespaces и files для доступа пользователям.

##### Команда для запуска

```bash
karma8 gw --config=./config.yml
```

##### Команда для получения справки

```bash
karma gw --help
```

#### karma8 discovery

- Хранит мета-информацию о файлах и их частях
- Хранит перечень серверов хранения
- Хранит информацию о пространствах пользователя

> **Note**
> 
> Namespace выступают в качестве примера.
> В реальном продакшине вы, вероятно, захотите добавить такие объекты как customer, project и прочие, здесь же считаем что один customer это один namespace.

##### Команда для запуска

```bash
karma8 discovery --config=./config.yml
```

##### Команда для получения справки

```bash
karma discovery --help
```

#### karma8 storage

- Хранит части файлов
- Ничего не знает о содержании файлов и алгоритме их разделения на части
- За хранение информации о том как файл был разделён и где находятся остальные части отвечает другой сервис - karma8 discovery

##### Команда для запуска

```bash
karma8 storage --config=./config.yml
```

##### Команда для получения справки

```bash
karma storage --help
```
### Правила разделения данных по нескольким серверам

| Engine    | Описание                           |
| :-------- | :-------                           |
| raid0     | Чередование серверов хранения      |
| raid1     | Зеркалирование серверов хранения   |

## Author

[Oleg Shevelev][mantyr]

[mantyr]: https://github.com/mantyr
